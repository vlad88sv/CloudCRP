{% extends "::base.html.twig" %}

{% block title %}LCCMainBundle:partida:mostrar{% endblock %}

{% block page_sub_header %}Nueva partida{% endblock %}

{% block body %}
    <div class="row">
        <div class="col-lg-4"  style="border-right: 1px solid lightblue;border-bottom: 1px solid lightblue; padding-bottom: 15px; margin-bottom: 15px;">    
            <form id="frmTransaccion">
                <fieldset>
                    <legend>Transaccion</legend>

                    <div class="form-group">
                        <div>
                            <label for="cmbCuentaAgrupacion">Cuenta</label>
                            <select class="form-control chosen" name="cmbCuentaAgrupacion" id="cmbCuentaAgrupacion">
                                <option value="">Seleccione una cuenta</option>
                                {% for cuenta in data.cuentas %}
                                    <option value="{{cuenta.id}}">{{cuenta.codigo}} :: {{cuenta.nombre}}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label for="txtMonto">Monto</label>
                                <div class="input-group">
                                    <div class="input-group-addon">$</div>
                                    <input id="txtMonto" min="0" type="number" class="form-control" value="0">
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-6"> 
                            <div class="form-group">
                                <div>
                                    <label for="cmbTipoMovimiento">Tipo de movimiento</label>
                                    <select class="form-control" name="cmbTipoMovimiento" id="cmbTipoMovimiento">
                                        <option value="0">Debe</option>
                                        <option value="1">Haber</option>                    
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>




                    <div class="form-group">
                        <label for="txtConcepto1">Concepto 1</label>
                        <input type="text" name="txtConcepto1" id="txtConcepto1" class="form-control" placeholder="">
                    </div>
                            
                    <div class="form-group">
                        <label for="txtConcepto2">Concepto 2</label>
                        <input type="text" name="txtConcepto2" id="txtConcepto2" class="form-control" placeholder="">
                    </div>

                    <div class="form-group">
                        <label for="txtConcepto3">Concepto 3</label>
                        <input type="text" name="txtConcepto3" id="txtConcepto3" class="form-control" placeholder="">
                    </div>
                </fieldset>
                <button id="btnAgregarTransaccion" type="submit" class="btn btn-default">Agregar transacción</button>
            </form>
        </div>
        <div class="col-lg-8">
            <fieldset>
                <legend>Datos de partida <button  type="submit" class="btn btn-danger pull-right">Guardar partida</button></legend>
                <form class="form-horizontal">
                    <div class="row">
                        <div class="col-sm-8">
                            <div class="form-group">
                                <label for="inputEmail3" class="col-sm-2 control-label">No. Partida</label>
                                <div class="col-sm-10">
                                    <input type="number" class="form-control" id="inputEmail3" placeholder="">
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-4">
                            <div class="form-group">
                                <label for="txtPartidaFecha" class="col-sm-2 control-label">Fecha</label>
                                <div class="col-sm-10">
                                    <input type="date" class="form-control" id="txtPartidaFecha" name="txtPartidaFecha" placeholder="">
                                </div>
                            </div>
                        </div>
                    </div>
                    <table id="tblTransacciones" class="table table-striped table-condensed table-bordered table-condensed">
                        <thead>
                            <tr>
                                <th>Cuenta</th><th>Debe</th><th>Haber</th><th>Acción</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>                    
                </form>
            </fieldset>
        </div>
    {% endblock %}
    {% block javascripts %}
        {{ parent() }}
        <script type="text/javascript">
            var transacciones = [];

            function hacerCargarGridTransacciones()
            {
                $('#tblTransacciones tbody tr').remove();

                for (index = 0; index < transacciones.length; ++index) {
                    console.log(transacciones[index]);
                    
                    var monto = parseFloat(transacciones[index]['monto']).toFixed(2);

                    var tr = $('<tr>').attr('rel', index);
                    tr.append($('<td>').html(transacciones[index]['cuenta']));
                    if (transacciones[index]['tipo'] === '1') {
                        tr.append($('<td>').html(''));
                        tr.append($('<td>').html(monto));
                    } else {
                        tr.append($('<td>').html(monto));
                        tr.append($('<td>').html(''));
                    }
                    
                    tr.append($('<td>').html('<button type="button" class="btn btn-sm btn-link btnEliminarTransaccion">Eliminar</button>'));
                    $('#tblTransacciones tbody').append(tr);
                }
            }

            function hacerAgregarTransaccion(e) {
                e.preventDefault();
                if ($("#cmbCuentaAgrupacion").val() === "") {
                    alert("Debe seleccionar una cuenta.");
                    return;
                }

                if (parseInt($("#txtMonto").val()) <= 0)
                {
                    alert("Debe ingresar un monto mayor que cero.");
                    return;
                }

                transacciones.push({
                    cuenta_id: $("#cmbCuentaAgrupacion").val(),
                    cuenta: $("#cmbCuentaAgrupacion :selected").text(),
                    monto: $("#txtMonto").val(),
                    tipo: $("#cmbTipoMovimiento").val(),
                    concepto1: $("#txtConcepto1").val(),
                    concepto2: $("#txtConcepto2").val(),
                    concepto3: $("#txtConcepto3").val()
                });

                $("#frmTransaccion")[0].reset();
                $(".chosen").val('').trigger("chosen:updated");
                hacerCargarGridTransacciones();
            }
            
            function eliminarTransaccion() {
                transacciones.splice(parseInt($(this).attr('rel')), 1);
                hacerCargarGridTransacciones();
            }

            $(function () {
                $("#txtPartidaFecha").datepicker({changeMonth: true, changeYear: true, dateFormat: 'yy-mm-dd'});
                $("#btnAgregarTransaccion").click(hacerAgregarTransaccion);
                $(document).on('click', '.btnEliminarTransaccion', eliminarTransaccion);
            });
        </script>
    {% endblock %}
